<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — BRINKS</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="brinks-header">
    <div class="header-inner">
      <h1>BRINKS</h1>
      <p>Global Services — Admin</p>
    </div>
  </header>

  <main>
    <section class="admin-card">
      <div class="admin-top">
        <h2>Add Shipment</h2>
        <button id="logoutBtn" class="btn-red">Logout</button>
      </div>

      <form id="adminForm">
        <input type="text" id="tracking" placeholder="Tracking ID" required />
        <input type="text" id="sender" placeholder="Sender" required />
        <input type="text" id="receiver" placeholder="Receiver" required />
        <input type="text" id="status" placeholder="Status (optional)" />
        <input type="text" id="security" placeholder="Security Level" required />
        <button type="submit">Add</button>
      </form>

      <div id="adminResult"></div>

      <hr>

      <h3>Update Shipment Status</h3>
      <form id="updateForm">
        <input type="text" id="updateTracking" placeholder="Tracking Number" required />
        <input type="text" id="newStatus" placeholder="New Status" required />
        <button type="submit">Update Status</button>
      </form>
    </section>
  </main>

  <script>
  // Logout button
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await fetch("/logout", { method: "POST" });
    window.location.href = "/login.html";
  });

  // Add shipment
  document.getElementById("adminForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const body = {
      tracking: document.getElementById("tracking").value.trim(),
      sender: document.getElementById("sender").value.trim(),
      receiver: document.getElementById("receiver").value.trim(),
      status: document.getElementById("status").value.trim(),
      securityLevel: document.getElementById("security").value.trim()
    };
    const res = await fetch("/add-shipment", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (data.success) {
      document.getElementById("adminResult").innerHTML = "<p style='color:green'>Shipment added.</p>";
      // clear fields
      document.getElementById("adminForm").reset();
    } else {
      document.getElementById("adminResult").innerHTML = "<p style='color:red'>Error: " + (data.error||data.message||"Failed") + "</p>";
    }
  });

  // Update status
  document.getElementById("updateForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const payload = {
      tracking: document.getElementById("updateTracking").value.trim(),
      status: document.getElementById("newStatus").value.trim()
    };
    const res = await fetch("/update-status", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (data.success) {
      alert("Status updated successfully!");
      document.getElementById("updateForm").reset();
    } else {
      alert("Error: " + (data.message || "Failed"));
    }
  });
  </script>
</body>
</html>